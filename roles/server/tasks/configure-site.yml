---
- name: "Configure Site '{{ outer_item.name }}'."  # noqa no-changed-when
  become: true
  ansible.builtin.shell: |
    set -o pipefail
    omd config {{ outer_item.name }} set {{ item.var }} {{ item.value }}
  args:
    executable: /bin/bash
  loop: "{{ outer_item.omd_config }}"
  when: outer_item.state != "absent"  and outer_item.omd_config | length
  tags:
    - configure-sites
