---
- name: "Enable powertools repository."
  become: 'yes'
  ansible.builtin.shell: dnf config-manager --set-enabled powertools
  when: ansible_distribution_major_version == "8"

- name: "Install Checkmk Server."
  become: 'yes'
  ansible.builtin.yum:
    name: "/tmp/{{ checkmk_server_setup_file }}"
    state: present
    disable_gpg_check: '{{ not checkmk_server_verify_setup | bool }}'

- name: "Enable httpd can network connect selinux boolean."
  become: 'yes'
  seboolean: 
    name: httpd_can_network_connect 
    state: yes 
    persistent: yes

- name: "Open ports for Checkmk."
  become: 'yes'
  ansible.posix.firewalld:
    port: "{{ item }}"
    permanent: 'yes'
    immediate: 'yes'
    state: enabled
  with_items:
    - "{{ checkmk_server_ports }}"
  when: checkmk_server_change_firewall | bool
  ignore_errors: true