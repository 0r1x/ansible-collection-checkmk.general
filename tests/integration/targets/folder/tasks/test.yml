---
# Take this from playbooks/test-full.yml to ensure full coverage!
# Be sure to remove header!

- name: "{{ outer_item.version }} - Create folders."
  folder:
    server_url: "{{ server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ automation_user }}"
    automation_secret: "{{ automation_secret }}"
    path: "{{ item.path }}"
    name: "{{ item.name }}"
    state: "present"
  delegate_to: localhost
  run_once: true  # noqa run-once
  loop: "{{ checkmk_folders }}"

- name: "{{ outer_item.version }} - Activate."
  activation:
    server_url: "{{ server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ automation_user }}"
    automation_secret: "{{ automation_secret }}"
    force_foreign_changes: true
    sites:
      - "{{ outer_item.site }}"
  delegate_to: localhost
  run_once: true  # noqa run-once

- name: "{{ outer_item.version }} - Delete folders."
  folder:
    server_url: "{{ server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ automation_user }}"
    automation_secret: "{{ automation_secret }}"
    path: "{{ item.path }}"
    name: "{{ item.name }}"
    state: "absent"
  delegate_to: localhost
  run_once: true  # noqa run-once
  loop: "{{ checkmk_folders }}"

- name: "{{ outer_item.version }} - Activate."
  activation:
    server_url: "{{ server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ automation_user }}"
    automation_secret: "{{ automation_secret }}"
    force_foreign_changes: true
    sites:
      - "{{ outer_item.site }}"
  delegate_to: localhost
  run_once: true  # noqa run-once
