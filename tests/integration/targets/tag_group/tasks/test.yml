---
- name: "{{ outer_item.version }} - {{ outer_item.edition | upper }} - Create tag_group."
  tag_group:
    server_url: "{{ checkmk_var_server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ checkmk_var_automation_user }}"
    automation_secret: "{{ checkmk_var_automation_secret }}"
    name: "{{ item.name }}"
    title: "{{ item.title }}"
    topic: "{{ item.topic }}"
    help: "{{ item.help }}"
    tags: "{{ item.tags }}"
    state: "present"
  delegate_to: localhost
  loop: "{{ checkmk_taggroups_create }}"

- name: "{{ outer_item.version }} - {{ outer_item.edition | upper }} - Activate changes."
  activation:
    server_url: "{{ checkmk_var_server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ checkmk_var_automation_user }}"
    automation_secret: "{{ checkmk_var_automation_secret }}"
  delegate_to: localhost
  run_once: true  # noqa run-once[task]

- name: "{{ outer_item.version }} - {{ outer_item.edition | upper }} - Update tag_group."
  tag_group:
    server_url: "{{ checkmk_var_server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ checkmk_var_automation_user }}"
    automation_secret: "{{ checkmk_var_automation_secret }}"
    name: "{{ item.name }}"
    title: "{{ item.title }}"
    topic: "{{ item.topic }}"
    help: "{{ item.help }}"
    tags: "{{ item.tags }}"
    state: "present"
  delegate_to: localhost
  loop: "{{ checkmk_taggroups_update }}"

- name: "{{ outer_item.version }} - {{ outer_item.edition | upper }} - Activate changes."
  activation:
    server_url: "{{ checkmk_var_server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ checkmk_var_automation_user }}"
    automation_secret: "{{ checkmk_var_automation_secret }}"
  delegate_to: localhost
  run_once: true  # noqa run-once[task]

- name: "{{ outer_item.version }} - {{ outer_item.edition | upper }} - Delete tag_group."
  tag_group:
    server_url: "{{ checkmk_var_server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ checkmk_var_automation_user }}"
    automation_secret: "{{ checkmk_var_automation_secret }}"
    name: "{{ item.name }}"
    state: "absent"
  delegate_to: localhost
  loop: "{{ checkmk_taggroups_delete }}"

- name: "{{ outer_item.version }} - {{ outer_item.edition | upper }} - Activate changes."
  activation:
    server_url: "{{ checkmk_var_server_url }}"
    site: "{{ outer_item.site }}"
    automation_user: "{{ checkmk_var_automation_user }}"
    automation_secret: "{{ checkmk_var_automation_secret }}"
  delegate_to: localhost
  run_once: true  # noqa run-once[task]
